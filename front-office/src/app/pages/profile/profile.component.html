<main class="profile-page">
  <section class="section-profile-cover section-shaped my-0">
    <!-- Circles background -->
    <div class="shape shape-style-1 shape-primary alpha-4">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
    <!-- SVG separator -->
    <div class="separator separator-bottom separator-skew">
      <svg x="0" y="0" viewBox="0 0 2560 100" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <polygon class="fill-white" points="2560 0 2560 100 0 100"></polygon>
      </svg>
    </div>
  </section>
  <section class="section">
    <div class="container">
      <div class="card card-profile shadow mt--300">
        <div class="px-4 my-10">
          <div>
            <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
              <div class="form-group flex flex-row px-[10%] gap-x-[100px]">
                <div class="flex flex-col gap-y-8">
                  <div>
                    <div>
                      Prénom :
                    </div>
                    <div
                        class="input-group input-group-alternative"
                        [class.valid]="profileForm.get('firstname').valid &&
                                (profileForm.get('firstname').dirty || profileForm.get('firstname').touched)"
                        [class.invalid]="profileForm.get('firstname').invalid &&
                                (profileForm.get('firstname').dirty || profileForm.get('firstname').touched)"
                    >
                      <input
                          formControlName="firstname"
                          class="form-control"
                          placeholder="Prénom"
                          type="text"
                      >
                    </div>

                    <div *ngIf="profileForm.get('firstname').invalid &&
                                  profileForm.get('firstname').errors &&
                                  (profileForm.get('firstname').dirty || profileForm.get('firstname').touched)"
                    >
                      <small class="text-red-500" *ngIf="profileForm.get('firstname').hasError('required')">
                        Ce champs est requis
                      </small>
                    </div>
                  </div>
                  <div>
                    <div>
                      Nom :
                    </div>
                    <div
                        class="input-group input-group-alternative mr-3"
                        [class.valid]="profileForm.get('lastname').valid &&
                                (profileForm.get('lastname').dirty || profileForm.get('lastname').touched)"
                        [class.invalid]="profileForm.get('lastname').invalid &&
                                (profileForm.get('lastname').dirty || profileForm.get('lastname').touched)"
                    >
                      <input
                          formControlName="lastname"
                          class="form-control"
                          placeholder="Nom"
                          type="text"
                      >
                    </div>

                    <div *ngIf="profileForm.get('lastname').invalid &&
                                  profileForm.get('lastname').errors &&
                                  (profileForm.get('lastname').dirty || profileForm.get('lastname').touched)"
                    >
                      <small class="text-red-500" *ngIf="profileForm.get('lastname').hasError('required')">
                        Ce champs est requis
                      </small>
                    </div>
                  </div>
                  <div>
                    <div>
                      Email :
                    </div>
                    <div
                        class="input-group input-group-alternative mr-3"
                        [class.valid]="profileForm.get('email').valid &&
                                (profileForm.get('email').dirty || profileForm.get('email').touched)"
                        [class.invalid]="profileForm.get('email').invalid &&
                                (profileForm.get('email').dirty || profileForm.get('email').touched)"
                    >
                      <input
                          formControlName="email"
                          class="form-control"
                          placeholder="Email"
                          type="email"
                      >
                    </div>

                    <div *ngIf="profileForm.get('email').invalid &&
                                  profileForm.get('email').errors &&
                                  (profileForm.get('email').dirty || profileForm.get('email').touched)"
                    >
                      <small class="text-red-500" *ngIf="profileForm.get('email').hasError('required')">
                        Ce champs est requis
                      </small>
                    </div>
                  </div>
                  <div>
                    <div>
                      Numéro de téléphone :
                    </div>
                    <div
                        class="input-group input-group-alternative mr-3"
                        [class.valid]="profileForm.get('phone').valid &&
                                (profileForm.get('phone').dirty || profileForm.get('phone').touched)"
                        [class.invalid]="profileForm.get('phone').invalid &&
                                (profileForm.get('phone').dirty || profileForm.get('phone').touched)"
                    >
                      <input
                          formControlName="phone"
                          class="form-control"
                          placeholder="Numero de telephone"
                          type="text"
                      >
                    </div>

                    <div *ngIf="profileForm.get('phone').invalid &&
                                  profileForm.get('phone').errors &&
                                  (profileForm.get('phone').dirty || profileForm.get('phone').touched)"
                    >
                      <small class="text-red-500" *ngIf="profileForm.get('phone').hasError('required')">
                        Ce champs est requis
                      </small>
                    </div>
                  </div>
                  <div>
                    <div>
                      Mot de passe actuel :
                    </div>
                    <div
                        class="input-group input-group-alternative mr-3"
                        [class.valid]="profileForm.get('currentPassword').valid &&
                                (profileForm.get('currentPassword').dirty || profileForm.get('currentPassword').touched)"
                        [class.invalid]="profileForm.get('currentPassword').invalid &&
                                (profileForm.get('currentPassword').dirty || profileForm.get('currentPassword').touched)"
                    >
                      <input
                          formControlName="currentPassword"
                          class="form-control"
                          placeholder="Mot de passe actuel"
                          type="password"
                      >
                    </div>
                  </div>
                  <div>
                    <div>
                      Nouveau mot de passe :
                    </div>
                    <div
                        class="input-group input-group-alternative mr-3"
                        [class.valid]="profileForm.get('password').valid &&
                                (profileForm.get('password').dirty || profileForm.get('password').touched)"
                        [class.invalid]="profileForm.get('password').invalid &&
                                (profileForm.get('password').dirty || profileForm.get('password').touched)"
                    >
                      <input
                          formControlName="password"
                          class="form-control"
                          placeholder="Nouveau mot de passe"
                          type="password"
                      >
                    </div>

                    <div *ngIf="profileForm.get('password').invalid &&
                                  profileForm.get('password').errors &&
                                  (profileForm.get('password').dirty || profileForm.get('password').touched)"
                    >
                      <small class="text-red-500" *ngIf="profileForm.get('password').hasError('required')">
                        Ce champs est requis
                      </small>
                    </div>
                  </div>
                  <div>
                    <div>
                      Confirmer le mot de passe :
                    </div>
                    <div
                        class="input-group input-group-alternative mr-3"
                        [class.valid]="profileForm.get('confirmPassword').valid &&
                                (profileForm.get('confirmPassword').dirty || profileForm.get('confirmPassword').touched)"
                        [class.invalid]="profileForm.get('confirmPassword').invalid &&
                                (profileForm.get('confirmPassword').dirty || profileForm.get('confirmPassword').touched)"
                    >
                      <input
                          formControlName="confirmPassword"
                          class="form-control"
                          placeholder="Confimation du mot de passe"
                          type="password"
                      >
                    </div>

                    <div *ngIf="profileForm.get('confirmPassword').invalid &&
                                  profileForm.get('confirmPassword').errors &&
                                  (profileForm.get('confirmPassword').dirty || profileForm.get('confirmPassword').touched)"
                    >
                      <small class="text-red-500" *ngIf="profileForm.get('confirmPassword').hasError('required')">
                        Ce champs est requis
                      </small>
                    </div>
                  </div>
                  <div class="flex flex-row">
                    <button type="submit" class="btn btn-black bg-black" [disabled]="!profileForm.valid">Enregistrer</button>
                    <button type="button" class="btn" [routerLink]="['/register']">Annuler</button>
                  </div>
                </div>
                <div class="flex flex-col flex-1">
                  <div>
                    <div>Préférences: employés</div>
                    <div class="table-container">
                      <table mat-table [dataSource]="employeeDataSource" matSort matSortActive="fullName" matSortDirection="asc" matSortDisableClear #employeeSort="matSort">
                        <ng-container matColumnDef="fullName">
                          <th mat-header-cell mat-sort-header *matHeaderCellDef >
                          <span class="font-bold">
                            Nom et prénom
                          </span>
                          </th>
                          <td mat-cell *matCellDef="let element"> {{element.fullName}} </td>
                        </ng-container>
                        <ng-container matColumnDef="isFavorite">
                          <th mat-header-cell *matHeaderCellDef >
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <fa-icon
                                [icon]="currentPreferences.employee.includes(element._id) ? faStar : faStarRegular"
                                class="hover: cursor-pointer"
                                (click)="togglePreferences('employee',element._id)"/>
                          </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="employeeDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: employeeDisplayedColumns"></tr>
                      </table>
                      <div class="flex justify-center" *ngIf="employeeDataSource.loading$ | async">
                        <mat-spinner diameter="25"></mat-spinner>
                      </div>
                    </div>
                    <mat-paginator [length]="employeeDataSource.length" [pageSize]="employeeDataSource.pageSize" #employeePaginator></mat-paginator>
                  </div>
                  <div>
                    <div>Préférences: services</div>
                    <div class="table-container">
                      <table mat-table [dataSource]="serviceDataSource" matSort matSortActive="name" matSortDirection="asc" matSortDisableClear #serviceSort="matSort">
                        <ng-container matColumnDef="name">
                          <th mat-header-cell mat-sort-header *matHeaderCellDef >
                          <span class="font-bold">
                            Nom du service
                          </span>
                          </th>
                          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                        </ng-container>
                        <ng-container matColumnDef="isFavorite">
                          <th mat-header-cell *matHeaderCellDef >
                          </th>
                          <td mat-cell *matCellDef="let element">
                            <fa-icon
                                [icon]="currentPreferences.service.includes(element._id) ? faStar : faStarRegular"
                                (click)="togglePreferences('service',element._id)"
                                class="hover: cursor-pointer"
                            />
                          </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="serviceDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: serviceDisplayedColumns"></tr>
                      </table>
                      <div class="flex justify-center" *ngIf="serviceDataSource.loading$ | async">
                        <mat-spinner diameter="25"></mat-spinner>
                      </div>
                    </div>
                    <mat-paginator [length]="serviceDataSource.length" [pageSize]="serviceDataSource.pageSize" #servicePaginator></mat-paginator>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
